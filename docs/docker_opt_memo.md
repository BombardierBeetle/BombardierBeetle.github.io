# dockerコンテナ生成時のメモ

コンテナのネットワーク、ボリュームの理解を深めてメモを作成したい
docker-composeについても


- todo tmpfsマウントを追記

## ネットワークのオプション


dockerネットワークの確認
    docker network ls

ネットワークドライバ

- bridge -デフォルト。NWドライバを指定しなければこれになる。
        アプリケーションが通信を必要としているスタンドアロンコンテナで使用する
- host - (docker17.06以降、swarmでのみ使用可能)スタンドアロン用。コンテナ、dockerホスト間の分離を無くす？
- none - コンテナ上で全てのNWが無効になる
以下はデフォルト環境では使われてない？
- overlay - dockerデーモン同士の接続、swarm等で使用か
- maclvan - コンテナがMacアドレスを保持可能

## ストレージ/ボリューム

3タイプがそんざい

- ボリューム
    バインドマウントと似ているが、ボリュームがDockerによって管理され、ホストマシンのコア機能から分離されている点が異なります。
    ボリュームは同時に複数のコンテナにマウント可能だが、**明示的に削除が必要**
    名前は指定orランダム（ランダムの場合、紐づけられたコンテナに関連する名前になるっぽい）
- バインドマウント
    初期からあった機能。ボリュームと比較して機能が少ない、
    ホストマシンのファイル/ディレクトリ（要フルパス指定、存在しない場合は作成）をコンテナにマウントさせる、当然ホストマシンのファイルシステムに依存
    *バインドマウントはコンテナ内からホストのFSを変更可能なため、セキュリティ上のリスクとなり得る*

> 新しいDockerアプリケーションを開発している場合は、代わりに名前付きボリュームを使用することを検討してください。
> バインドマウントを直接管理するためにDocker CLIコマンドを使用することはできません。

- tmpfsマウント
    ホストシステムのメモリにのみ保存され、ホストシステムのファイルシステムには書き込まれません。
    **DockerをLinux上で実行している場合にのみ利用可能**

### ボリューム・よいユースケース

- 実行中の複数のコンテナ間でデータを共有する。
- Dockerホストが特定のディレクトリまたはファイル構造を持つことが保証されていないとき。ボリュームを使用すると、Dockerホストの構成をコンテナーランタイムから切り離すことができます。
- コンテナのデータをローカルではなくリモートホストまたはクラウドプロバイダに保存する場合。
- あるDockerホストから別のDockerホストにデータをバックアップ、復元、または移行する必要がある場合は、ボリュームをお勧めします。ボリュームを使用しているコンテナを停止してから、ボリュームのディレクトリ（例:/var/lib/docker/volumes/\<volume-name>）をバックアップできます。

### バインドマウント・よいユースケース

- ホストマシンからコンテナへの設定ファイルの共有 ―これは、ホストマシンから/etc/resolv.confを各コンテナーにマウントすることによって、DockerがデフォルトでコンテナーにDNS解決を提供する方法です。
- Dockerホスト上の開発環境とコンテナーの間でソースコードを共有したり、成果物を構築したりします。たとえば、Mavenの target/ ディレクトリをコンテナにマウントし、Dockerホスト上でMavenプロジェクトをビルドするたびに、コンテナは再構築されたアーティファクトにアクセスできます。
    このように開発にDockerを使用すると、本番用Dockerfileはバインドマウントに頼るのではなく、本番用の成果物を直接イメージにコピーします。
- Dockerホストのファイルまたはディレクトリ構造が、コンテナが必要とするバインドマウントと一致していることが保証されている場合。

### tmpfsの使用例

ファイルまたはディレクトリが存在するコンテナ内のディレクトリに**空のボリューム**をマウントすると、それらのファイルまたはディレクトリはボリュームに伝播（コピー）されます。同様に、コンテナを起動して、まだ存在していないボリュームを指定すると、空のボリュームが自動的に作成されます。これは別のコンテナが必要とするデータを事前に設定するのに良い方法です。

あなたがマウントした場合、**バインドマウントまたは非空のボリューム**いくつかのファイルまたはディレクトリが存在するコンテナ内のディレクトリに、これらのファイルまたはディレクトリは、あなたがにファイルを保存したかのように、マウントによって覆い隠され/mnt、Linuxホストにして実装しましたUSBドライブに/mnt。内容は、/mntUSBドライブをアンマウントしたまでは、USBドライブの内容によって隠されることになります。隠されたファイルは削除または変更されませんが、バインドマウントまたはボリュームがマウントされている間はアクセスできません。


## docker-composeについて
専用のディレクトリを作成し,docker-compose.yml内にDSLを書く事でコンテナをまとめて実行可能
最大の利点はdocker-compose up/downで一括で処理かのうなこと？

```docker-compose例
version "3"
services:
    echo:
        image: example/test:latest
        ports:
          - 9000:8080
```
