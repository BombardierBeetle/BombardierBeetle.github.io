# dockerコンテナ生成時のメモ

コンテナのネットワーク、ボリュームの理解を深めてメモを作成したい
docker-composeについても


- todo tmpfsマウントを追記

# ネットワークのオプション


dockerネットワークの確認
    docker network ls

ネットワークドライバ

- bridge -デフォルト。NWドライバを指定しなければこれになる。
        アプリケーションが通信を必要としているスタンドアロンコンテナで使用する
- host - (docker17.06以降、swarmでのみ使用可能)スタンドアロン用。コンテナ、dockerホスト間の分離を無くす？
- none - コンテナ上で全てのNWが無効になる
以下はデフォルト環境では存在しない？
- overlay - dockerデーモン同士の接続、swarm等で使用する？
- maclvan - コンテナがMacアドレスを保持可能


# ストレージ/ボリューム

2タイプ
- ボリューム
    バインドマウントと似ているが、ボリュームがDockerによって管理され、ホストマシンのコア機能から分離されている点が異なります。
    ボリュームは同時に複数のコンテナにマウント可能
    名前は指定orランダム、明示的に削除が必要、
- バインドマウント
    初期からあった機能。ボリュームと比較して機能が少ない、
    ホストマシンのファイル/ディレクトリ（要フルパス指定、存在しない場合は作成）をコンテナにマウントさせる、
    ホストマシンのファイルシステムに依存
    バインドマウントはコンテナ内からホストのFSを変更可能なため、セキュリティ上のリスクとなり得る
    >新しいDockerアプリケーションを開発している場合は、代わりに名前付きボリュームを使用することを検討してください。バインドマウントを直接管理するためにDocker CLIコマンドを使用することはできません。

## ボリューム・よいユースケース

- 実行中の複数のコンテナ間でデータを共有する。
    ボリュームは明示的に削除した場合にのみ削除されます。
- Dockerホストが特定のディレクトリまたはファイル構造を持つことが保証されていないとき。ボリュームを使用すると、Dockerホストの構成をコンテナーランタイムから切り離すことができます。
- コンテナのデータをローカルではなくリモートホストまたはクラウドプロバイダに保存する場合。
- あるDockerホストから別のDockerホストにデータをバックアップ、復元、または移行する必要がある場合は、ボリュームをお勧めします。ボリュームを使用しているコンテナを停止してから、ボリュームのディレクトリ（など/var/lib/docker/volumes/<volume-name>）をバックアップできます。

## バインドマウント・よいユースケース

- ホストマシンからコンテナへの設定ファイルの共有 これが、Docker /etc/resolv.confがホストマシンから各コンテナーにマウントすることによって、デフォルトでコンテナーにDNS解決を提供する方法です 。
- Dockerホスト上の開発環境とコンテナーの間でソースコードを共有したり、成果物を構築したりします。たとえば、Maven target/ ディレクトリをコンテナにマウントし、Dockerホスト上でMavenプロジェクトをビルドするたびに、コンテナは再構築されたアーティファクトにアクセスできます。
    このように開発にDockerを使用すると、本番用Dockerfileはバインドマウントに頼るのではなく、本番用の成果物を直接イメージにコピーします。
- Dockerホストのファイルまたはディレクトリ構造が、コンテナが必要とするバインドマウントと一致していることが保証されている場合。


# docker-composeについて

専用のディレクトリを作成し,docker-compose.yml内にDSLを書く事でコンテナをまとめて実行可能
最大の利点はdocker-compose up/downで一括で処理かのうなこと？

```docker-compose例
version "3"
services:
    echo:
        image: example/test:latest
        ports:
          - 9000:8080
```
