

#PXE bootメモ

## なにこれ

諸般の事情でPXEブートに頼らざるを得なかったのでメモ

具体的にはUSBインストールメディアから直接インストール/ブートできなかったため、
PXEブート→WindowsPE→コマンドラインからUSB上のsetup実行

本ドキュメントはPXEの正式なドキュメントを確認していないので、
PXEは下記手順（DHCPにオプションを使用）に準ずるが、他のやり方もあるらしいので
メーカー独自のオプションや拡張がありそうなプラットフォームは注意、というかPXEのドキュメントを洗った方がいい

## 環境

- 2012年頃のノートPC
- サーバ用Windows PC(Win10 1809/x64)
- 2台のPC同士を接続するためのLANハブ
    組織内のLAN上で下記手順を実行すると、DHCPが動作するため面倒なことになる
    対象端末同士でLANの直結を推奨
    PC-PCでLANケーブルを直結するためにはクロスケーブルが必要になるため、間にハブをかませる 

## 概要

- Pros
諸事情により外部ストレージブートが難しい場合
外部ストレージ不要

- Cons
PXEブートをONにするハードル
DHCPサーバを利用するので、既存LANへの配慮もしくは分離が必要
起動OSのブートファイル/実体を置くTFTP、SMB等のサーバを用意する必要あり

## 用意するもの

- DHCPサーバ
    PXEブートは、DHCPによりIPアドレス及びPXEサーバのアドレスを通知
    DHCPサーバによってはクライアントのMACアドレスによって振る舞いを変えてくれるらしいが、今回は触れない
- TFTPサーバ
    PXEサーバはTFTPサーバからブートに必要なファイルを取得する
    実際は他のプロトコルもOK?要確認
    Windowsでtftp,dhcpを動作させる場合はDHCP,TFTPサーバは[TFTPD32](http://tftpd32.jounin.net/tftpd32.html)が便利
- PXEブートイメージ
    PXEブート用イメージ
    Windowsの場合はWindowsADKからWindowsPEを作成し、TFTPサーバ側に配置
-(オプション)ファイルサーバ
    PXEブート後、ネットワークインストール等を実施する場合は必要
    しない（ただPXEブートしたい、ブート後USBメモリ等からインストールを実施）場合は不要



## 大まかな手順

- DHCPサーバを立てる
    DHCPプールの例 192.168.1.100-200/24 GW 192.168.1.254
- DHCPのオプションでDHCPと同じサブネット上にtftpサーバのアドレス,ブートファイルを指定
    アドレス例 192.168.1.201/24
- LAN接続した対象端末を起動、PXEブートさせる
    環境にもよるが起動に数分かかる
- 起動完了
    windowsRE環境でUSBドライブのセットアップを起動する場合は以下コマンド
'cmd
dir
cd c:
setup.exe
'

